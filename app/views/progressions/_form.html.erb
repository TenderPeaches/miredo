<% key ||= Key.find_by_shorthand('C') %>
<% scale ||= Scale.find_by_name('Major') %>
<%= tag.fieldset do %>
    <% if defined? progression_number %>
        <%= tag.legend "#{progression_number.to_s}) #{progression.tag}" %>
    <% else %>
        <%= tag.legend t('actions.new', thing: t('models.progression.model_name')) %>
    <% end %>
    <%= form_with model: progression, class: "progression-form", local: false do |form| %>
        <%= render partial: "progressions/errors", locals: { progression: progression } %>

        <%# render partial: "progressions/as_bars", locals: { progression: progression, key: key, scale: scale } %>
        <%= render partial: "progressions/fields", locals: { form: form } %>
        <%= tag.div class: "field progression-print" do %>
            <%= progression.print(key, scale) %>
        <% end %>
        
        <%= render partial: "progressions/chords", locals: { form: form, progression: progression } %>

        <% puts progression.inspect %>

        <%= link_to t('actions.add', thing: t('models.progression_chord.model_name')), add_chord_to_progression_path, data: { turbo_stream: true } %>
        <%# link_to_add_association t('actions.add', thing: t('models.progression_chord.model_name') ), form, :progression_chords, { partial: "progression_chords/gen", form_name: "form", render_options: { locals: { key: key, scale: scale } } }%>

        <%= form.submit t('actions.create', thing: t('models.progression.model_name')) %>
    <% end %>
<% end %>
